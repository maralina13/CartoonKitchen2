<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title th:text="${dish.name}">Рецепт</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-4">
    <h2 th:text="${dish.name}">Название</h2>

    <div class="row my-3">
        <div class="col-md-6" th:if="${dish.cartoonImageUrl}">
            <img class="img-fluid rounded" th:src="${dish.cartoonImageUrl}" alt="Картинка из мультфильма">
        </div>
        <div class="col-md-6" th:if="${dish.imageUrl}">
            <img class="img-fluid rounded" th:src="${dish.imageUrl}" alt="Готовое блюдо">
        </div>
    </div>

    <p><strong>Категория:</strong> <span th:text="${dish.category.name}"></span></p>
    <p th:if="${dish.author}"><strong>Автор:</strong> <span th:text="${dish.author.username}"></span></p>

    <h4>Ингредиенты:</h4>
    <ul class="mb-3">
        <li th:each="ingredient : ${dish.ingredients}" th:text="${ingredient.name}"></li>
    </ul>

    <h4>Шаги приготовления:</h4>
    <ol class="mb-4">
        <li th:each="step : ${dish.steps}">
            <p th:text="${step.description}"></p>
        </li>
    </ol>

    <div class="btn-toolbar gap-2 mb-3" role="toolbar">

        <div class="btn-group" role="group">

            <form sec:authorize="isAuthenticated()"
                  th:action="@{/favorites/toggle}" method="post" class="d-inline">
                <input type="hidden" name="dishId" th:value="${dish.id}">
                <input type="hidden" name="back" th:value="${'/dishes/' + dish.id}">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                <button class="btn btn-outline-primary btn-sm" type="submit"
                        th:text="${isFavorite} ? '✓ В избранном (убрать)' : '❤ В избранное'">
                    ❤ В избранное
                </button>
            </form>

            <a sec:authorize="isAnonymous()"
               th:href="@{/login}" class="btn btn-outline-secondary btn-sm">
                Войдите, чтобы добавить в избранное
            </a>

            <a sec:authorize="isAuthenticated()"
               th:href="@{/favorites}" class="btn btn-outline-warning btn-sm">
                ❤ Мои избранные
            </a>
        </div>

        <div class="btn-group" role="group" th:if="${canEdit}">
            <a class="btn btn-outline-primary btn-sm" th:href="@{/dishes/{id}/edit(id=${dish.id})}">
                Редактировать
            </a>

            <form class="d-inline" th:action="@{/dishes/delete/{id}(id=${dish.id})}" method="post">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                <button type="submit" class="btn btn-outline-danger btn-sm"
                        onclick="return confirm('Удалить рецепт?')">
                    Удалить
                </button>
            </form>
        </div>
    </div>

    <a href="/" class="btn btn-link">← Назад</a>
</div>
</body>
</html>
