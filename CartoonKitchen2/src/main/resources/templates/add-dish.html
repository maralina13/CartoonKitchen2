<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- Select2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Select2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <meta charset="UTF-8">
    <title>Добавить новое блюдо</title>
</head>
<body>
<h1>Добавить новое блюдо</h1>

<form action="/dishes/add" method="post" enctype="multipart/form-data">
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

    <label>Название:</label><br>
    <input type="text" name="name" required><br><br>

    <label>Категория (название фильма/мультфильма):</label><br>
    <input type="text" name="categoryName" required><br><br>

    <label>Ингредиенты:</label><br>
    <select id="ingredient-select" name="ingredientIds" multiple="multiple" style="width: 300px;">
        <option th:each="ingredient : ${ingredients}"
                th:value="${ingredient.id}"
                th:text="${ingredient.name}">
        </option>
    </select><br><br>

    <label>Новые ингредиенты (если не нашли нужный):</label><br>
    <select id="new-ingredient-input" name="newIngredients" multiple="multiple" style="width: 300px;"></select><br><br>

    <label>Итоговое фото блюда:</label><br>
    <input type="file" name="finalImage" required><br><br>

    <label>Фото из мультфильма:</label><br>
    <input type="file" name="cartoonImage" required><br><br>

    <h2>Шаги приготовления:</h2>
    <div id="steps-container"></div>
    <button type="button" onclick="addStep()">+ Добавить шаг</button><br><br>

    <button type="submit">Сохранить блюдо</button>
</form>

<script>
    // Select2 для выбора ингредиентов из базы
    $('#ingredient-select').select2({
        placeholder: "Выберите ингредиенты",
        allowClear: true
    });

    // Select2 для ввода новых ингредиентов
    $('#new-ingredient-input').select2({
        tags: true,
        placeholder: "Введите новые ингредиенты",
        tokenSeparators: [',']
    });
        let stepIndex = 0;

        function addStep() {
        const container = document.getElementById("steps-container");

        const stepDiv = document.createElement("div");
        stepDiv.classList.add("step-block");

        stepDiv.innerHTML = `
          <h3 class="step-title">Шаг ${stepIndex + 1}:</h3>
          <textarea name="stepDescriptions" required></textarea><br>
          Фото к шагу:
          <input type="file" name="stepImages"><br>
          <button type="button" onclick="removeStep(this)">Удалить шаг</button>
          <hr>
        `;

        container.appendChild(stepDiv);
        stepIndex++;
        updateStepNumbers();
    }

        function removeStep(button) {
        button.closest(".step-block").remove();
        updateStepNumbers();
    }

        function updateStepNumbers() {
        const steps = document.querySelectorAll(".step-block");
        steps.forEach((step, index) => {
        step.querySelector(".step-title").innerText = `Шаг ${index + 1}:`;
    });
    }

        window.onload = () => {
        addStep();
    };
</script>

</body>
</html>
